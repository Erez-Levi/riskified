apiVersion: v1
kind: Pod
metadata:
  name: app-pod
  labels:
    app: app
spec:
  containers:
  - name: app-pod
    image: {{ .Values.pod.image }}:{{ .Values.pod.tag }}
    ports:
    - containerPort: 8080
    env:
    - name: RESPONSE
      value: {{ .Values.pod.response }}
    volumeMounts:
    - name: app-volume
      mountPath: /opt/app-volume
  - name: count-agent
    env:
    - name: FLUENTD_CONF
      value: /opt/fluentd/fluentd.conf
    image: erzez/fluentd:1.5
    volumeMounts:
    - name: app-volume
      mountPath: /var/log
    - name: config-volume
      mountPath: /opt/fluentd/
  volumes:
    - name: app-volume
      persistentVolumeClaim:
        claimName: my-claim
    - name: config-volume
      configMap:
        name: fluentd-config
