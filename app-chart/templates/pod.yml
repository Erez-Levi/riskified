apiVersion: v1
kind: Pod
metadata:
  name: app-pod
  labels:
    app: app
spec:
  containers:
  - name: app-pod
    image: {{ .Values.pod.image }}:{{ .Values.pod.tag }}
    ports:
    - containerPort: 8080
    env:
    - name: RESPONSE
      value: {{ .Values.pod.response }}
    volumeMounts:
    - name: app-volume
      mountPath: /opt/app-volume
  - name: count-agent
    image: k8s.gcr.io/fluentd-gcp:1.30
    env:
    - name: FLUENTD_ARGS
      value: -c /etc/fluentd-config/fluentd.conf
    volumeMounts:
    - name: app-volume
      mountPath: /var/log
    - name: config-volume
      mountPath: /etc/fluentd-config    
  volumes:
    - name: app-volume
      persistentVolumeClaim:
        claimName: my-claim
    - name: config-volume
      configMap:
        name: fluentd-config
